0.8^10
round(1.25, 1)
round(1.35, 1)
round(1.351, 1)
round(1.350001, 1)
round(1.250001, 1)
load("D:/workspace.RData")
load("D:/workspace.RData")
print(getwd())
exp(10)
library(foreign)
hei <- read.dta('D:/NUS Dropbox/Xiangyuan Huang/research/HEI/MEC Revisit_Data File 20210703/MEC Revisit_Data File 20210703.dta')
library(foreign)
library(haven)
hei <- read_dta('D:/NUS Dropbox/Xiangyuan Huang/research/HEI/MEC Revisit_Data File 20210703/MEC Revisit_Data File 20210703.dta')
View(hei)
library(tidyverse)
library(magrittr)
hei %<>% mutate(cognitiveimpairment =
ifelse(h8regroup3_new == 1, total_mmse <= 24,
ifelse(h8regroup3_new == 2, total_mmse <= 26,
total_mmse <= 28)))
table(hei$cognitiveimpairment)
hei$ahei2010rv
mean(hei$ahei2010rv)
hei$p.veg_ahei10_rv4
hei$veg_ahei10_rv
lm(data = hei, total_mmse ~ veg_ahei10_rv + fruit_ahei10_rv + wholegrain_ahei10_rv + ssb_ahei10_rv_v2 + nuts_legumes_ahei10_rv + redprocmeat_ahei10_rv + totalfreshseafood_ahei10_rv + pufa_ahei10_rv + fid500_ahei10_rv)
lm(data = hei, total_mmse ~ veg_ahei10_rv + fruit_ahei10_rv + wholegrain_ahei10_rv
+ ssb_ahei10_rv_v2 + nuts_legumes_ahei10_rv + redprocmeat_ahei10_rv +
totalfreshseafood_ahei10_rv + pufa_ahei10_rv + fid500_ahei10_rv) %>%
summary
hei %<>% mutate(cognitiveimpairment =
ifelse(h8regroup3_new == 1, total_mmse <= 24,
ifelse(h8regroup3_new == 2, total_mmse <= 26,
total_mmse <= 28)),
ahei2010rv4 = ntile(ahei2010rv, 4))
table(hei$ahei2010rv4)
hei$ahei2010rv4
lm(data = hei, total_mmse ~ factor(ahei2010rv4) + intage_m gender factor(ethderived) +
lm(data = hei, total_mmse ~ factor(ahei2010rv4) + intage_m gender + factor(ethderived) +
lm(data = hei, total_mmse ~ factor(ahei2010rv4) + intage_m + gender + factor(ethderived) +
factor(h7recode2) + factor(h8regroup5_new) + energy_kcal_per_day_r) %>%
summary
lm(data = hei, total_mmse ~ veg_ahei10_rv + fruit_ahei10_rv + wholegrain_ahei10_rv
+ ssb_ahei10_rv_v2 + nuts_legumes_ahei10_rv + redprocmeat_ahei10_rv +
totalfreshseafood_ahei10_rv + pufa_ahei10_rv + fid500_ahei10_rv) %>%
summary
library(car)
vif(lm(total_mmse ~ veg_ahei10_rv + fruit_ahei10_rv + wholegrain_ahei10_rv +
ssb_ahei10_rv_v2 + nuts_legumes_ahei10_rv + redprocmeat_ahei10_rv +
totalfreshseafood_ahei10_rv + pufa_ahei10_rv + fid500_ahei10_rv,
data = hei))
diet_vars <- hei[, c("veg_ahei10_rv", "fruit_ahei10_rv", "wholegrain_ahei10_rv",
"ssb_ahei10_rv_v2", "nuts_legumes_ahei10_rv",
"redprocmeat_ahei10_rv", "totalfreshseafood_ahei10_rv",
"pufa_ahei10_rv", "fid500_ahei10_rv")]
pca_res <- prcomp(diet_vars, scale. = TRUE)
summary(pca_res)
pca_res <- prcomp(diet_vars, scale. = TRUE)
pca_res
hei$pc1 <- pca_res$x[, 1]
cor(hei$pc1, hei$ahei2010rv, use = "complete.obs")
library(car)
vif(lm(total_mmse ~ veg_ahei10_rv + fruit_ahei10_rv + wholegrain_ahei10_rv +
ssb_ahei10_rv_v2 + nuts_legumes_ahei10_rv + redprocmeat_ahei10_rv +
totalfreshseafood_ahei10_rv + pufa_ahei10_rv + fid500_ahei10_rv +
intage_m + gender + factor(ethderived) +
factor(h7recode2) + factor(h8regroup5_new) + energy_kcal_per_day_r,
data = hei))
diet_vars <- hei[, c("veg_ahei10_rv", "fruit_ahei10_rv", "wholegrain_ahei10_rv",
"ssb_ahei10_rv_v2", "nuts_legumes_ahei10_rv",
"redprocmeat_ahei10_rv", "totalfreshseafood_ahei10_rv",
"pufa_ahei10_rv", "fid500_ahei10_rv")]
pca_res <- prcomp(diet_vars, scale. = TRUE)
summary(pca_res)
85*12/10
rm(list = ls()) #0213
res <- read.csv('D:/interaction.csv')
p <- res %>% filter(str_detect(X, '^ls')) %>%
mutate(quantile = str_extract(model, '[0-9]'),
quantile = as.numeric(quantile),
int = str_replace(model, '[0-9]', ''),
cat = ((quantile -1) %/% 3) + 1)
# Library ----
library(colorspace)
library(ggplot2)
# library(ggsci)
library(haven)
# library(jomo)
library(lme4)
library(lqmm)
library(lqmix)
library(magrittr)
# library(mice)
library(quantreg)
# library(qrLMM)
library(readxl)
library(rms)
library(rtf)
library(simstudy)
library(tidyverse)
p <- res %>% filter(str_detect(X, '^ls')) %>%
mutate(quantile = str_extract(model, '[0-9]'),
quantile = as.numeric(quantile),
int = str_replace(model, '[0-9]', ''),
cat = ((quantile -1) %/% 3) + 1)
View(p)
p <- res %>% filter(str_detect(X, '^ls')) %>%
mutate(quantile = str_extract(model, '[0-9]'),
quantile = as.numeric(quantile),
int = str_replace(model, '[0-9]', ''),
cat = ((quantile -1) %/% 3) + 1,
index = quantile - cat*3)
View(p)
p <- res %>% filter(str_detect(X, '^ls')) %>%
mutate(quantile = str_extract(model, '[0-9]'),
quantile = as.numeric(quantile),
int = str_replace(model, '[0-9]', ''),
cat = ((quantile -1) %/% 3) + 1,
index = quantile - (cat - 1)*3)
View(p)
library(forestplot)
install.packages('forestplot')
library(forestplot)
?forestplot
row_names <- list(list("test = 1", expression(test >= 2)))
test_data <- data.frame(
coef = c(1.59, 1.24),
low = c(1.4, 0.78),
high = c(1.8, 1.55)
)
View(test_data)
test_data |>
forestplot(labeltext = row_names,
mean = coef,
lower = low,
upper = high,
zero = 1,
cex  = 2,
lineheight = "auto",
xlab = "Lab axis txt") |>
fp_add_header("Group") |>
fp_set_style(lines = gpar(col = "darkblue"))
# Print two plots side by side using the grid
# package's layout option for viewports
fp1 <- test_data |>
forestplot(labeltext = row_names,
mean = coef,
lower = low,
upper = high,
zero = 1,
cex  = 2,
lineheight = "auto",
title = "Plot 1",
xlab = "Lab axis txt")
fp1
View(test_data)
View(test_data)
forestplot(data = p,
labeltext = int,
mean = Value,
lower = lower.bound,
upper = upper.bound)
p$Value
p %>%
forestplot(labeltext = int,
mean = Value,
lower = lower.bound,
upper = upper.bound)
df <- data.frame(
variable = rep(c("BMI", "Blood Pressure", "Cholesterol"), each = 2),
group = rep(c("25th percentile", "75th percentile"), 3),
estimate = c(0.8, 1.2, 0.9, 1.3, 0.7, 1.1),
lower = c(0.6, 1.0, 0.7, 1.1, 0.5, 0.9),
upper = c(1.0, 1.4, 1.1, 1.5, 0.9, 1.3)
)
ggplot(df, aes(x = variable, y = estimate, color = group)) +
geom_point(position = position_dodge(width = 0.6), size = 3) +
geom_errorbar(
aes(ymin = lower, ymax = upper),
width = 0.2,
position = position_dodge(width = 0.6)
) +
geom_hline(yintercept = 1, linetype = "dashed") +
coord_flip() +  # horizontal forest style
theme_minimal() +
labs(y = "Hazard Ratio (95% CI)", x = NULL, color = "Percentile Group")
View(df)
ggplot(p, aes(x = int, y = Value, color = index)) +
geom_point(position = position_dodge(width = 0.6), size = 3) +
geom_errorbar(
aes(ymin = lower.bound, ymax = upper.bound),
width = 0.2,
position = position_dodge(width = 0.6)
)
p <- res %>% filter(str_detect(X, '^ls')) %>%
mutate(quantile = str_extract(model, '[0-9]'),
quantile = as.numeric(quantile),
int = str_replace(model, '[0-9]', ''),
cat = ((quantile -1) %/% 3) + 1,
index = quantile - (cat - 1)*3,
index = letters[index])
ggplot(p, aes(x = int, y = Value, color = index)) +
geom_point(position = position_dodge(width = 0.6), size = 3) +
geom_errorbar(
aes(ymin = lower.bound, ymax = upper.bound),
width = 0.2,
position = position_dodge(width = 0.6)
)
ggplot(p, aes(x = int, y = Value, color = index)) +
geom_point(position = position_dodge(width = 0.6), size = 3) +
geom_errorbar(
aes(ymin = lower.bound, ymax = upper.bound),
width = 0.2,
position = position_dodge(width = 0.6)
) +
geom_hline(yintercept = 0, linetype = "dashed") +
coord_flip()
ggplot(p, aes(x = int, y = Value, color = index)) +
geom_point(position = position_dodge(width = 0.6), size = 3) +
geom_errorbar(
aes(ymin = lower.bound, ymax = upper.bound),
width = 0.2,
position = position_dodge(width = 0.6)
) +
geom_hline(yintercept = 0, linetype = "dashed") +
coord_flip() +  # horizontal forest style
theme_minimal() +
labs(y = "Regression coefficient (95% CI)", x = NULL, color = "Percentile Group")
p <- res %>% filter(str_detect(X, '^ls')) %>%
mutate(quantile = str_extract(model, '[0-9]'),
quantile = as.numeric(quantile),
int = str_replace(model, '[0-9]', ''),
cat = ((quantile -1) %/% 3) + 1,
index = quantile - (cat - 1)*3,
index = letters[index],
strata = paste0(int, cat)
)
table(p$strata)
p <- res %>% filter(str_detect(X, '^ls')) %>%
mutate(quantile = str_extract(model, '[0-9]'),
quantile = as.numeric(quantile),
int = str_replace(model, '[0-9]', ''),
cat = ((quantile -1) %/% 3) + 1,
index = quantile - (cat - 1)*3,
index = letters[index],
strata = paste0(int, cat),
strata = recode(strata, 'Ia1' = 'Below 60',
'Ia2' = '60 and above')
)
p
table(p$strata)
p <- res %>% filter(str_detect(X, '^ls')) %>%
mutate(quantile = str_extract(model, '[0-9]'),
quantile = as.numeric(quantile),
int = str_replace(model, '[0-9]', ''),
cat = ((quantile -1) %/% 3) + 1,
index = quantile - (cat - 1)*3,
index = letters[index],
strata = paste0(int, cat),
strata = recode(strata, 'Ia1' = '60 and above',
'Ia2' = 'Below 60',
'Id1' = 'primary&below',
'Id2' = 'above primary',
'Ie1' = 'Chinese',
'Ie2' = 'Malay',
'Ie3' = 'Indian',
'Im1' = 'Unmarried',
'Im2' = 'Married',
'Is1' = 'Male',
'Is2' = 'Female'))
ggplot(p, aes(x = strata, y = Value, color = index)) +
geom_point(position = position_dodge(width = 0.6), size = 3) +
geom_errorbar(
aes(ymin = lower.bound, ymax = upper.bound),
width = 0.2,
position = position_dodge(width = 0.6)
)
ggplot(p, aes(x = strata, y = Value, color = index)) +
geom_point(position = position_dodge(width = 0.6), size = 3) +
geom_errorbar(
aes(ymin = lower.bound, ymax = upper.bound),
width = 0.2,
position = position_dodge(width = 0.6)
) +
geom_hline(yintercept = 0, linetype = "dashed") +
coord_flip() +  # horizontal forest style
theme_minimal() +
labs(y = "Regression coefficient (95% CI)", x = NULL, color = "Percentile Group")
table(p$strata)
p <- res %>% filter(str_detect(X, '^ls')) %>%
mutate(quantile = str_extract(model, '[0-9]'),
quantile = as.numeric(quantile),
int = str_replace(model, '[0-9]', ''),
cat = ((quantile -1) %/% 3) + 1,
index = quantile - (cat - 1)*3,
index = letters[index],
strata = paste0(int, cat),
strata = recode(strata, 'Ia1' = '60 and above',
'Ia2' = 'Below 60',
'Id1' = 'Primary&below',
'Id2' = 'Above primary',
'Ie1' = 'Chinese',
'Ie2' = 'Malay',
'Ie3' = 'Indian',
'Im1' = 'Unmarried',
'Im2' = 'Married',
'Is1' = 'Male',
'Is2' = 'Female'),
strata = factor(strata, levels = c(
'Married', 'Unmarried', 'Above primary', 'Primary&below',
'Indian', 'Malay', 'Chinese', 'Female', 'Male',
'Below 60', '60 and above')))
ggplot(p, aes(x = strata, y = Value, color = index)) +
geom_point(position = position_dodge(width = 0.6), size = 3) +
geom_errorbar(
aes(ymin = lower.bound, ymax = upper.bound),
width = 0.2,
position = position_dodge(width = 0.6)
) +
geom_hline(yintercept = 0, linetype = "dashed") +
coord_flip() +  # horizontal forest style
theme_minimal() +
labs(y = "Regression coefficient (95% CI)", x = NULL, color = "Percentile Group")
View(p)
p <- res %>% filter(str_detect(X, '^ls')) %>%
mutate(quantile = str_extract(model, '[0-9]'),
quantile = as.numeric(quantile),
int = str_replace(model, '[0-9]', ''),
cat = ((quantile -1) %/% 3) + 1,
index = quantile - (cat - 1)*3,
index = letters[index],
strata = paste0(int, cat),
strata = recode(strata, 'Ia1' = '60 and above',
'Ia2' = 'Below 60',
'Id1' = 'Primary&below',
'Id2' = 'Above primary',
'Ie1' = 'Chinese',
'Ie2' = 'Malay',
'Ie3' = 'Indian',
'Im1' = 'Unmarried',
'Im2' = 'Married',
'Is1' = 'Male',
'Is2' = 'Female'),
strata = factor(strata, levels = c(
'Married', 'Unmarried', 'Above primary', 'Primary&below',
'Indian', 'Malay', 'Chinese', 'Female', 'Male',
'Below 60', '60 and above')),
index = recode(index, 'a' = '10%',
'b' = '30%',
'c' = '50%'))
ggplot(p, aes(x = strata, y = Value, color = index)) +
geom_point(position = position_dodge(width = 0.6), size = 3) +
geom_errorbar(
aes(ymin = lower.bound, ymax = upper.bound),
width = 0.2,
position = position_dodge(width = 0.6)
) +
geom_hline(yintercept = 0, linetype = "dashed") +
coord_flip() +  # horizontal forest style
theme_minimal() +
labs(y = "Regression coefficient (95% CI)", x = NULL, color = "")
ggsave('D:/interaction.tiff', dpi = 300, width = 8, height = 10)
ggsave('D:/interaction.tiff', dpi = 300, width = 6, height = 8)
2.54*5
14.5/2.54
2.5*6
0.46-0.04
0.42/(1.96*2)
0.26/0.1071429
pnorm(2.42666)
pnorm(-2.42666)
0.07*9
0.05/9
pnorm(-0.25/(0.42/1.96*2))
pnorm(-0.25/(0.42/(1.96*2)))
library(Rcpp)
library(RcppArmadillo)
# Compile your C++ file
sourceCpp("D:/loglik.cpp")   # <-- name of the file you saved
library(Rcpp)
library(RcppArmadillo)
# Compile your C++ file
sourceCpp("D:/loglik.cpp")   # <-- name of the file you saved
library(Rcpp)
library(RcppArmadillo)
# Compile your C++ file
sourceCpp("D:/loglik.cpp")   # <-- name of the file you saved
qlog <- rep(log(0.1), 12)   # 12 transition intensities (log scale)
llog <- rep(log(0.05), 5)   # 5 killing hazards (log scale)
# Simple test transitions
state0 <- c(1, 2, 3)
state1 <- c(2, 3, 4)
dt     <- c(1.0, 1.5, 2.0)
# Dummy helper if not implemented yet
build_Q_from_qexp <- function(qexp) {
Q <- matrix(0, 5, 5)
# simplest placeholder: diagonal -sum(row), upper-diagonal some rates
Q[1, 2] <- qexp[1]; Q[1, 3] <- qexp[2]
Q[2, 3] <- qexp[3]; Q[2, 4] <- qexp[4]
for (i in 1:5) Q[i, i] <- -sum(Q[i, ])
Q
}
# Now run it
msm_killed_loglik_perfect(qlog, llog, state0, state1, dt)
31/129
exp(-8.5)
485/100
1144/12
2000*10.8*5.5
1.635*5.5
75000/12
600000/6000
400000/6000
125*5
145*4
145*3
exp(-0.48)
0.1/0.35
0.1/0.30
0.1/0.25
log(0.25/0.35)
480/0.9
rm(list = ls())
setwd('D:/NUS Dropbox/Xiangyuan Huang/github/')
setwd('NeCTAR/sampleSize')
# Library ----
# install.packages('gsDesign', repos = 'https://cran.r-project.org/')
library(brms)
library(doParallel)
library(gsDesign)
library(magrittr)
library(tidyverse)
result <- read.csv('result/samplepriorP-033.csv')
stat <- result %>% mutate(sig1 = (sig1a < 0)|(sig1b < 0)|(sig1c < 0),
sig2 = (sig2a < 0)|(sig2b < 0),
sig3 = (sig3a < 0)|(sig3b < 0),
sig4 = (sig4a < 0)|(sig4b < 0),
sig5 = (sig5a < 0)|(sig5b < 0)|(sig5c < 0),
sig6 = (sig6a < 0)|(sig6b < 0),
sig7 = (sig7a < 0)|(sig7b < 0),
sig8 = (sig8a < 0)|(sig8b < 0),
sig9 = sig025 < 0,
sig10 = sig050 < 0) %>%
group_by(N, rateFL, delta, p0) %>%
summarize(count = n(),
typeO1 = mean(sig1)*100,
typeO2 = mean(sig2)*100,
typeO3 = mean(sig3)*100,
typeO4 = mean(sig4)*100,
typeO5 = mean(sig5)*100,
typeO6 = mean(sig6)*100,
typeO7 = mean(sig7)*100,
typeO8 = mean(sig8)*100,
typeO9 = mean(sig9)*100,
typeO10 = mean(sig10)*100) %>%
mutate(delta = as.factor(delta),
p0 = as.factor(p0))
View(stat)
p0 <- ggplot(data = stat, aes(x = N)) +
geom_smooth(aes(group = delta, col = delta),
alpha = 0.5, linewidth = 0.5, se = F) +
geom_point(aes(col = delta, shape = delta)) +
labs(x = 'Sample Size', y = 'Proportion of significance (%)',
color = 'Delta', shape = 'Delta')+ geom_hline(
yintercept = c(80, 2.5), linetype = "dashed", color = "gray40") +
scale_y_continuous(breaks = c(0, 2.5, 20, 40, 60, 80, 100), limits = c(0, 100))
p0 + aes(y = typeO1)
p0 + aes(y = typeO5)
View(stat)
# Preparation ----
library(boot)
library(doParallel)
library(fixest)
library(foreach)
library(ggplot2)
library(magrittr)
library(tidyverse)
set.seed(123)
if (getwd() != 'D:/NUS Dropbox/Xiangyuan Huang/github/DID') {
setwd('DID')
}
setwd('D:/NUS Dropbox/Xiangyuan Huang/github/')
if (getwd() != 'D:/NUS Dropbox/Xiangyuan Huang/github/DID') {
setwd('DID')
}
setwd('D:/NUS Dropbox/Xiangyuan Huang/github/')
getwd()
dir()
str_detect(getwd(), 'github')
setwd('D:/NUS Dropbox/Xiangyuan Huang/github/')
ifelse(str_detect(getwd(), 'github'),
setwd('DID_detectASIA'), setwd('DID_detectASIA'))
cat("wd =", getwd(), "\n")
